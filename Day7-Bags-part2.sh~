#!/bin/bash

#input file
input=$1
sed -e 's/ contain/,/; s/[ \.0-9]//g;s/bags*//g' $input >temp 
awk '
function conteneur(a,i, list,j,bags){
list=i 
if(i in a){
 #print i " in a"
 split(a[i],bags,"-")
 #print(length(bags))
 for (j=1;j<=length(bags);j++){
  #print "feuille de " i,bags[j]
  list=list "-" conteneur(a,bags[j])   
 }
}


return list
}

BEGIN{FS=","}
{
 for (i=2;i<=NF;i++){ 
  a[$i] = ( ($i in a) ? ($1"-"a[$i]) : $1 )}
} 
END{print conteneur(a,"shinygold")}' temp | sed 's/shinygold-//'> temp2

awk '{split($1,a,"-");for(i=1;i<=length(a);i++){b[a[i]]=1}}END{print length(b)}' temp2
